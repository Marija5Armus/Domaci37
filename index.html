<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vremenska prognoza</title>
    <!-- CSS only -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

<!-- JS, Popper.js, and jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>

<!-- CSS main -->
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="wrap" class=" justify-content-around ">
 <div class=" text-align-center justify-content-center jumbotron-fluid">
       <h4 class="display-4 bg-light">Vremenska prognoza </h4>
       <div class="bg-light"> <label for="dugme" class=""> Unesi ime grada: </label>
        <span class="lead"> <input type="text" name="grad" id="grad" placeholder="Unesi naziv na engleskom..." size="30vw"> 
        <!-- <button id="dugme" class="btn btn-outline-dark">Prikazi prognozu</button></p> --></div>
       
       <hr class="my-4">
       <p><div id="ispis"></div></p>
</div> 
     <div id="wrap2" class="d-block flex-wrap row d-md-flex justify-content-around"> </div>
  
</div>
<script>
const ispis=document.getElementById('ispis');
const ispis2=document.querySelector('ispis2');
const wrap=document.getElementById('wrap');
const wrap2=document.getElementById('wrap2');
const dugme=document.getElementById('dugme');
var imeGrada=document.getElementById("grad");

 function ucitajPrognozu(){


 var proxyServer = 'https://proxy-requests.herokuapp.com/' // zbog CORS ogranicenja kreiramo rpoxy server
  const apiUrl = `https://www.metaweather.com/api/location/search/?query=${imeGrada.value}`;
  wrap2.innerHTML="";

  fetch(proxyServer+apiUrl)
  .then(response => response.json())
.then(data=>{
//console.log(data);
   // console.log(data.woeid);
    ispis.innerHTML=`Vremenska prognoza za ${data[0].title}, njen kod je ${data[0].woeid} `;
var a=data[0].woeid;
    
   // zbog CORS ogranicenja kreiramo rpoxy server
  const api = `https://www.metaweather.com/api/location/${a}/`;
  

  fetch(proxyServer+api)
  .then(response1 => response1.json())
.then(d=>{
 rezultat(d);
 console.log(d);
//console.log(d.woeid); not
// console.log(d[0].woeid); yes
})
.catch(error=> {console.error("Error", error)});
})
 
};

function rezultat(d){
    // if(!imeGrada.value.contains(d.title.toString())){
    //         wrap2.innerHTML="Nema rezultata za taj pojam!"
    //     }
    
 wrap2.innerHTML=`<div id="ispis2" class="row">
 <p>Grad:${d.title.toString()}</p>
            <p>Drzava:${d.parent.title.toString()} </p>
            <p>Vremenska zona:${d.timezone} </p>
            <p>Izlazak sunca:${d.sun_rise.toString()} </p>
            <p>Zalazak sunca: ${d.sun_set.toString()}</p></div>
 <div class="icon-box col">
           <p> Prognoza za <strong>danas</strong>  </p>
            <p> Datum: ${d.consolidated_weather[0].applicable_date.toString()} </p>
            <p> Prosečna temperatura:${d.consolidated_weather[0].the_temp.toFixed(1)} &#8451</p>
            <p> <img src="https://www.metaweather.com/static/img/weather/${d.consolidated_weather[0].weather_state_abbr.toString()}.svg"></img> </p>
            <p> Opis : ${d.consolidated_weather[0].weather_state_name.toString()} </p>
            <p> Maksimalna dnevna temperatura:${d.consolidated_weather[0].max_temp.toFixed(1)} </p>
            <p> Minimalna dnevna temperatura:${d.consolidated_weather[0].min_temp.toFixed(1)} </p>
            
        </div>
        <div class="icon-box col">
            <p> Prognoza za <strong>sutra</strong> </p>
            <p> Datum: ${d.consolidated_weather[1].applicable_date.toString()} </p>
            <p> Prosečna temperatura:${d.consolidated_weather[1].the_temp.toFixed(1)}&#8451 </p>
            <p> <img src="https://www.metaweather.com/static/img/weather/${d.consolidated_weather[1].weather_state_abbr.toString()}.svg"></img> </p>
            <p> Opis : ${d.consolidated_weather[1].weather_state_name.toString()} </p>
            <p> Maksimalna dnevna temperatura:${d.consolidated_weather[1].max_temp.toFixed(1)} </p>
            <p> Minimalna dnevna temperatura:${d.consolidated_weather[1].min_temp.toFixed(1)} </p>
            
        </div>
        <div class="icon-box col">
            <p> Prognoza za <strong>prekosutra</strong> </p>
            <p> Datum: ${d.consolidated_weather[2].applicable_date.toString()} </p>
            <p> Prosečna temperatura:${d.consolidated_weather[2].the_temp.toFixed(1)}&#8451 </p>
            <p> <img src="https://www.metaweather.com/static/img/weather/${d.consolidated_weather[2].weather_state_abbr.toString()}.svg"></img> </p>
            <p> Opis : ${d.consolidated_weather[2].weather_state_name.toString()} </p>
            <p> Maksimalna dnevna temperatura:${d.consolidated_weather[2].max_temp.toFixed(1)} </p>
            <p> Minimalna dnevna temperatura:${d.consolidated_weather[2].min_temp.toFixed(1)} </p>
            
        </div>
        <div class="icon-box col">
            <p> Prognoza za <strong>nakosutra</strong> </p>
            <p> Datum: ${d.consolidated_weather[3].applicable_date.toString()} </p>
            <p> Prosečna temperatura:${d.consolidated_weather[3].the_temp.toFixed(1)}&#8451 </p>
            <p> <img src="https://www.metaweather.com/static/img/weather/${d.consolidated_weather[3].weather_state_abbr.toString()}.svg"></img> </p>
            <p> Opis : ${d.consolidated_weather[3].weather_state_name.toString()} </p>
            <p> Maksimalna dnevna temperatura:${d.consolidated_weather[3].max_temp.toFixed(1)} </p>
            <p> Minimalna dnevna temperatura:${d.consolidated_weather[3].min_temp.toFixed(1)} </p>
            
        </div>
        <div class="icon-box col">
            <p> Prognoza za <strong>jakosutra</strong> </p>
            <p> Datum: ${d.consolidated_weather[4].applicable_date.toString()} </p>
            <p> Prosečna temperatura:${d.consolidated_weather[4].the_temp.toFixed(1)}&#8451 </p>
            <p> <img src="https://www.metaweather.com/static/img/weather/${d.consolidated_weather[4].weather_state_abbr.toString()}.svg"></img> </p>
            <p> Opis : ${d.consolidated_weather[4].weather_state_name.toString()} </p>
            <p> Maksimalna dnevna temperatura:${d.consolidated_weather[4].max_temp.toFixed(1)} </p>
            <p> Minimalna dnevna temperatura:${d.consolidated_weather[4].min_temp.toFixed(1)} </p>
            
        </div>`;

        switch (d.consolidated_weather[0].weather_state_abbr.toString()) {
            case "sn":  wrap.style.backgroundImage="url(snow.jpg)";
                
                break;
                case "sl": wrap.style.backgroundImage="url(sleet.jpg)";
                
                break;
                case "h": wrap.style.backgroundImage="url(hail.jpg)";
                
                break;
                case "t": wrap.style.backgroundImage="url(thunderstorm.jpg)";
                
                break;
                case "hr": wrap.style.backgroundImage="url(heavy-rain.jpg)";
                
                break;
                case "lr": wrap.style.backgroundImage="url(light-rain.jpg)";
                
                break;
                case "s": wrap.style.backgroundImage="url(showers.jpg)";
                
                break;
                case "hc": wrap.style.backgroundImage="url(heavy-cloud.jpg)";
                
                break;
                case "lc": wrap.style.backgroundImage="url(light-cloud.jpg)";
                
                break;
                case "c": wrap.style.backgroundImage="url(beautiful-sunny-weather--green_1366x768.png)";
                
                break;

        
            default:wrap.style.backgroundImage="url(beautiful-sunny-weather--green_1366x768.png)";
                break;
        }
}


// dugme.addEventListener('click', ucitajPrognozu);

imeGrada.addEventListener('focus', function(){  
    imeGrada.value="";
  });
imeGrada.addEventListener('input', ucitajPrognozu);

    </script>
</body>
</html>